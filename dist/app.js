import{definePanel as e}from"@directus/extensions-sdk";import{resolveComponent as n,openBlock as t,createElementBlock as a,createVNode as l,createElementVNode as o,defineComponent as i,ref as r,watch as d,computed as s,onMounted as u,onBeforeUnmount as c,Fragment as p,createCommentVNode as m,normalizeClass as v,withCtx as f,createBlock as y,toDisplayString as g,renderList as h,createTextVNode as _,pushScopeId as w,popScopeId as k,defineAsyncComponent as b,unref as x}from"vue";var S=[],C=[];function V(e,n){if(e&&"undefined"!=typeof document){var t,a=!0===n.prepend?"prepend":"append",l=!0===n.singleTag,o="string"==typeof n.container?document.querySelector(n.container):document.getElementsByTagName("head")[0];if(l){var i=S.indexOf(o);-1===i&&(i=S.push(o)-1,C[i]={}),t=C[i]&&C[i][a]?C[i][a]:C[i][a]=r()}else t=r();65279===e.charCodeAt(0)&&(e=e.substring(1)),t.styleSheet?t.styleSheet.cssText+=e:t.appendChild(document.createTextNode(e))}function r(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),n.attributes)for(var t=Object.keys(n.attributes),l=0;l<t.length;l++)e.setAttribute(t[l],n.attributes[t[l]]);var i="prepend"===a?"afterbegin":"beforeend";return o.insertAdjacentElement(i,e),e}}V("\n.loading {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  gap: 1rem;\n  width: 100%;\n  height: 100%;\n}\n",{});var T=(e,n)=>{const t=e.__vccOpts||e;for(const[e,a]of n)t[e]=a;return t};const A={},D={class:"loading"},L=o("span",null,"Connecting to Spotify...",-1);var E=T(A,[["render",function(e,o){const i=n("v-progress-circular");return t(),a("div",D,[l(i,{large:"",indeterminate:""}),L])}],["__file","player-loading.vue"]]);const I=e=>(w("data-v-13575719"),e=e(),k(),e),N={key:0},P={class:"nowplaying__image"},j=["src"],B={class:"nowplaying__detail"},W={style:{"font-size":"12px"}},z=["href"],H=I((()=>o("p",null,"Volume Slider:",-1))),M=I((()=>o("span",{class:"sr-only"},"Volume Toggle",-1))),O=I((()=>o("p",null,"Audio Track Slider:",-1)));var R=i({__name:"player",props:{player:{},defaultVolume:{},allowControls:{type:Boolean}},setup(e){const{player:i,defaultVolume:w,allowControls:k}=e,b=r(0);d(b,(e=>{i.seek(e).then((()=>{console.log("Audio Seek updated!")}))}));const x=r(w);d(x,(e=>{i.setVolume(e).then((()=>{console.log("Volume updated!")}))}));const S=s((()=>0===x.value?"volume_off":x.value<.2?"volume_mute":x.value<.7?"volume_down":"volume_up")),C=r(),V=r(),T=r(!1);function A(e){var n,t,a,l;console.log("updatestate",e),C.value={...e},b.value=(null==(n=C.value)?void 0:n.position)||0,V.value=null==(a=null==(t=C.value)?void 0:t.track_window)?void 0:a.current_track,T.value=!(null==(l=C.value)?void 0:l.paused)}return u((()=>{console.log("Mounted"),i.addListener("player_state_changed",A),i.getCurrentState().then(A),i.getVolume().then((e=>x.value=e))})),c((()=>{console.log("Un Mounted"),i.removeListener("player_state_changed",A)})),i.on("playback_error",(({message:e})=>{console.error("Failed to perform playback",e)})),(e,i)=>{const r=n("v-progress-circular"),d=n("v-icon"),s=n("v-card"),u=n("v-button"),c=n("v-slider");return t(),a("div",null,[e.player?(t(),a(p,{key:1},[m(' <div v-if="!isActive">\n      <p>\n        We are ready to start playing music!\n      </p>\n      <p>\n        Please use the spotify app to transfer the music over to Directus.\n      </p>\n    </div> '),o("div",{class:v(["cards",{"has-header":e.showHeader}])},[l(s,{class:"nowplaying"},{default:f((()=>{var e,n,l,i,r,s;return[o("div",P,[V.value?(t(),a("img",{key:0,src:null==(i=null==(l=null==(n=null==(e=V.value)?void 0:e.album)?void 0:n.images)?void 0:l.find((e=>"SMALL"===(null==e?void 0:e.size))))?void 0:i.url},null,8,j)):(t(),y(d,{key:1,name:"signal_disconnected",large:""}))]),o("div",B,[o("div",null,g((null==(r=V.value)?void 0:r.name)||"Spotify Disconnected"),1),o("div",W,[(t(!0),a(p,null,h((null==(s=V.value)?void 0:s.artists)||[],(e=>(t(),a(p,null,[o("a",{href:e.url},g(e.name),9,z),_(", ")],64)))),256))])])]})),_:1}),e.allowControls&&V.value?(t(),y(s,{key:0,class:"controls"},{default:f((()=>[l(u,{class:"btn-action","x-small":"",icon:"",rounded:"",onClick:i[0]||(i[0]=n=>e.player.previousTrack())},{default:f((()=>[l(d,{name:"skip_previous"})])),_:1}),l(u,{class:"btn-action",icon:"",rounded:""},{default:f((()=>[l(d,{name:T.value?"pause":"play_arrow",onClick:i[1]||(i[1]=n=>e.player.togglePlay())},null,8,["name"]),m(" ")])),_:1}),l(u,{class:"btn-action","x-small":"",icon:"",rounded:""},{default:f((()=>[l(d,{name:"skip_next",onClick:i[2]||(i[2]=n=>e.player.nextTrack())})])),_:1})])),_:1})):m("v-if",!0),e.allowControls&&V.value?(t(),y(s,{key:1,class:"controls"},{default:f((()=>[H,l(d,{name:S.value,left:"",clickable:"",large:""},{default:f((()=>[M])),_:1},8,["name"]),l(c,{class:"v-slider","aria-label":"Volume Slider",disabled:!1,max:1,min:0,step:.01,modelValue:x.value,"onUpdate:modelValue":i[3]||(i[3]=e=>x.value=e)},null,8,["modelValue"])])),_:1})):m("v-if",!0),e.allowControls&&V.value?(t(),y(s,{key:2,class:"controls"},{default:f((()=>{var e;return[O,l(c,{class:"v-slider","aria-label":"Audio Track Slider",disabled:!1,max:C.value.duration,min:0,step:(null==(e=V.value)?void 0:e.duration_ms)/6e4*60,modelValue:b.value,"onUpdate:modelValue":i[4]||(i[4]=e=>b.value=e)},null,8,["max","step","modelValue"])]})),_:1})):m("v-if",!0)],2)],2112)):(t(),a("div",N,[l(r,{large:"",indeterminate:""})]))])}}});V("\n.text[data-v-13575719] {\n\tpadding: 12px;\n}\n.text.has-header[data-v-13575719] {\n\tpadding: 0 12px;\n}\n.sr-only[data-v-13575719] {\n\tvisibility: hidden;\n}\n.cards[data-v-13575719]  {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  padding: 1rem;\n}\n.v-slider[data-v-13575719] {\n  margin-top: 0.5rem;\n}\n.controls[data-v-13575719] {\n  display: flex;\n  justify-content: space-evenly;\n  align-items: space-between;\n  padding: 1rem;\n}\n.nowplaying[data-v-13575719] {\n  display: flex;\n  width: 100%;\n  align-items: center;\n  gap: 1rem;\n  padding: 1rem;\n}\n.nowplaying__image[data-v-13575719] {\n  width:64px; \n  height:64px;\n  background: var(--background-normal-alt);\n  border-radius: 5px;\n\n  overflow: hidden;\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n.nowplaying__detail[data-v-13575719] {\n  display: flex;\n  flex-direction: column;\n}\n",{});var U=T(R,[["__scopeId","data-v-13575719"],["__file","player.vue"]]);const q=[],F=[],K=[],$=[],G=[e({id:"directus-spotify",name:"Spotify",icon:"library_music",description:"Control your Spotify music from within Directus!",component:T(i({__name:"panel",props:{apiToken:{},streamName:{default:"Directus"},allowControls:{type:Boolean,default:!0},defaultVolume:{default:50},showHeader:{type:Boolean,default:!1}},setup(e){const n=e;let i=r();const s=r();function u(...e){console.info("%cðŸŽ§ Spotify!","color:#1ED760;font-weight:bold",...e)}const c=b({loader:()=>new Promise(((e,t)=>window.activeSpotify?(u("Reattaching previously loaded spotify player"),i.value=window.activeSpotify,e(U)):n.apiToken?(d(s,(()=>{!function(e){if(!document.getElementById("spotify-script")){var n=document.createElement("script");n.src="https://sdk.scdn.co/spotify-player.js",n.id="spotify-script",e.appendChild(n)}}(s.value)})),void(window.onSpotifyWebPlaybackSDKReady=()=>{const a=new Spotify.Player({name:n.streamName,getOAuthToken:e=>{e(n.apiToken)},volume:n.defaultVolume/100}),l=({message:e})=>{console.error("initialization_error",e),t(e)};a.addListener("not_ready",(({device_id:e})=>{u("Device ID has gone offline",e),t("Unable to connect to device")})),a.addListener("initialization_error",l),a.addListener("authentication_error",l),a.addListener("account_error",l),a.addListener("autoplay_failed",(()=>{u("Autoplay is not allowed by the browser autoplay rules"),a.activateElement()})),a.connect().then((e=>{e&&u("Successfully connected to Spotify as ${props.streamName}!")})),a.addListener("ready",(({device_id:n})=>{u("Ready with Device ID",n),i.value=window.activeSpotify=a,e(U)}))})):t("Missing API Token"))),loadingComponent:E});return(e,n)=>(t(),a(p,null,[o("div",{ref_key:"sdkInsertElement",ref:s},null,512),l(x(c),{player:x(i),defaultVolume:e.defaultVolume/100,allowControls:e.allowControls},null,8,["player","defaultVolume","allowControls"])],64))}}),[["__file","panel.vue"]]),options:[{field:"apiToken",name:"API Token",type:"text",meta:{note:"Retrieve your 1H token from https://developer.spotify.com/documentation/web-playback-sdk/tutorials/getting-started",interface:"input",width:"full"}},{field:"streamName",name:"Friendly Stream Name",type:"string",meta:{note:"What name should appear under the cast options in Spotify?",interface:"input",width:"half"},schema:{default_value:"Directus"}},{field:"allowControls",name:"Allow Controls",type:"boolean",meta:{note:"Should the interactive media controls be displayed?",width:"half",interface:"toggle",required:!0},schema:{default_value:!1}},{field:"defaultVolume",name:"Default Volume",type:"string",meta:{note:"What volume (0-100) should be the default when this player connects?",interface:"slider",width:"full"},schema:{default_value:50}}],minWidth:20,minHeight:6})],J=[];export{F as displays,q as interfaces,K as layouts,$ as modules,J as operations,G as panels};
